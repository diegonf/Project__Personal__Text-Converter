name: ðŸš€ Deploy website on push on main

on: 
  push: 
    branches:
      - main
jobs:
  build:
    name: Build Artifact
    runs-on: ubuntu-latest
    steps: 
      - name: Checkout
        uses: actions/checkout@v2
      
      - name: Installing Dependencies
        run: npm ci

      - name: Build Project
        run: npm run build

      - name: Creting Deployment Artifact
        env: 
          GITHUB_SHA: ${{ github.sha }}
        run: tar -czf "${GITHUB_SHA}".tar.gz build

      - name: Storing Artifact
        uses: actions/upload-artifact@v2
        with: 
          name: app-build
          path: ${{ github.sha }}.tar.gz

  web-deploy:
    name: ðŸŽ‰ Deploy to Server
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Get Artifact
        uses: actions/download-artifact@v2
        with:
          name: app-build

    # - name: ðŸšš Get latest code
    #   uses: actions/checkout@v2
    
    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@4.3.0
      with:
        server: ${{ secrets.ftp_host }}
        username: ${{ secrets.ftp_user }}
        password: ${{ secrets.ftp_password }}
        server-dir: txtconverter.dailysimpletools.com/
        source: ${{ github.sha }}.tar.gz
        